<html>
  <head>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
      }
      #input_button {
        display: block;
        margin: 10px 0;
      }
      #img1 {
        display: block;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      #loading {
        display: none;
        margin: 10px 0;
        font-size: 14px;
        color: #aaa;
      }
      #result {
        margin: 10px 0;
        font-size: 24px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    Make sure to run this via a server
    <br>
    <input accept="image/*" type='file' id="input_button" />
    <br>
    <img id="img1" src="./image.jpg" style="width: 300px " />
    <br>  <br>
    <button onclick="predict()">predict</button>
    <br>
    <div id="loading">Loading model...</div>
    <p id="result"> </p>
    <script>
      let image = document.getElementById('img1');
      let input_button = document.getElementById('input_button');
      let loading = document.getElementById('loading');
      let result = document.getElementById('result');

      input_button.onchange = evt => {
        const [file] = input_button.files
        if (file) {
          image.src = URL.createObjectURL(file)
        }
      }

      async function predict() {
        loading.style.display = 'block';
        result.style.display = 'none';

        var model = await tf.loadGraphModel('./model.json');

        let example = tf.browser.fromPixels(document.getElementById("img1"), 3).cast('float32');
        console.log(example.shape);
        example = example.reshape([1, example.shape[0], example.shape[1], example.shape[2]]);

        let prediction = await model.predict(example);
        let class_scores = await prediction.data();
        let max_score_id = class_scores.indexOf(Math.max(...class_scores));
        let classes = ["cat", "dog", "alouatta_palliata", "aotus_nigriceps", "cacajao_calvus", "cebuella_pygmea", "cebus_capucinus", "erythrocebus_patas", "macaca_fuscata", "mico_argentatus", "saimiri_sciureus", "trachypithecus_johnii"];

        console.log(class_scores);
        result.innerHTML = classes[max_score_id].
        toString();

        loading.style.display = 'none';
        result.style.display = 'block';
      }
    </script>
  </body>
</html>
