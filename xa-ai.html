<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Kai</title>
    <style>
        body {
            font-family: Arial;
            font-size: 20px;
            margin: 0;
            padding: 0;
        }
        #header {
            background-color: #000000;
            color: #ffffff;
            padding: 20px;
        }
        #header h1 {
            margin: 0;
        }
        #main {
            display: flex;
        }
        #sidebar {
            flex: 1;
            background-color: #dddddd;
            padding: 20px;
        }
        #content {
            flex: 3;
            background-color: #ffffff;
            padding: 20px;
        }
        #footer {
            background-color: #000000;
            color: #ffffff;
            padding: 20px;
            text-align: center;
        }
        #footer a {
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>Kai</h1>
    </div>
    <div id="main">
        <div id="sidebar">
            <p>
                <a href="kai.html">Home</a>
            </p>
            <p>
                <a href="kai.html#about">About</a>
            </p>
            <p>
                <a href="kai.html#contact">Contact</a>
            </p>
        </div>
        <div id="content">
            <h2 id="about">About</h2>
            <p>
                Kai is a web application that allows users to process text documents and visualize the data using a variety of techniques. The application is currently under development.
            </p>
            <h2 id="contact">Contact</h2>
            <p>
                If you would like to contact me, please send an email to <a href="mailto:">.</a>
<html>
<head>
    <meta charset="UTF-8">
    <title>Display Characters</title>
    <style>
        #character-display {
            font-size: 72px;
            font-family: Arial;
            font-weight: bold;
            color: red;
            text-align: center;
            margin-top: 50px;
        }
        #custom-symbol {
            font-size: 72px;
            font-family: Arial;
            font-weight: bold;
            color: blue;
            text-align: center;
            margin-top: 50px;
        }
        #data-display {
            margin-top: 50px;
            border: 1px solid black;
            padding: 10px;
        }
        #raw-data-display {
            margin-top: 50px;
            border: 1px solid black;
            padding: 10px;
            height: 200px;
            overflow: auto;
        }
    </style>
    <script>
        // open IndexedDB database
        var dbPromise = window.indexedDB.open("character-db", 1);

        dbPromise.onupgradeneeded = function(event) {
            var db = event.target.result;
            var objectStore = db.createObjectStore("characters", { keyPath: "id", autoIncrement: true });
            objectStore.createIndex("character", "character", { unique: false });
            objectStore.createIndex("symbol", "symbol", { unique: false });
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in
        var dbPromise = window.indexedDB.open("character-db", 1);

        dbPromise.onupgradeneeded = function(event) {
            var db = event.target.result;
            var objectStore = db.createObjectStore("characters", { keyPath: "id", autoIncrement: true });
            objectStore.createIndex("character", "character", { unique: false });
            objectStore.createIndex("symbol", "symbol", { unique: false });
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var hierarchy = [];
            var currentLevel = 0;
            var currentGroup = [];
            var currentGroupString = "";
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                if (match.length > currentLevel) {
                    // increase level
                    currentLevel++;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                } else if (match.length < currentLevel) {
                    // decrease level
                    currentLevel--;
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                    hierarchy.push(currentGroup);
                    currentGroup = [];
                    // set current group to parent group
                    for (var j = 0; j < hierarchy.length; j++) {
                        var group = hierarchy[j];
                        if (group.indexOf(currentGroupString) > -1) {
                            currentGroup = group;
                            break;
                        }
                    }
                } else {
                    // same level
                    currentGroup.push(currentGroupString);
                    currentGroupString = "";
                }
                currentGroupString += match;
            }
            return hierarchy;
        }

        function displayCharacter() {
            var character = document.getElementById("character").value;
            var symbol = document.getElementById("symbol").value;
            var characterDisplay = document.getElementById("character-display");
            var customSymbolDisplay = document.getElementById("custom-symbol");
            characterDisplay.innerText = character;
            customSymbolDisplay.innerText = symbol;
            var weight = 1 - Math.abs("A".charCodeAt(0) - character.toUpperCase().charCodeAt(0)) / 25;
            characterDisplay.style.opacity = weight;
            // store data in IndexedDB
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readwrite");
                var store = tx.objectStore("characters");
                var data = { character: character, symbol: symbol };
                store.add(data);
                return tx.complete;
            });
            // display stored data in data-display element
            var dataDisplay = document.getElementById("data-display");
            dataDisplay.innerHTML = "";
            dbPromise.then(function(db) {
                var tx = db.transaction("characters", "readonly");
                var store = tx.objectStore("characters");
                return store.openCursor();
            }).then(function(cursor) {
                if (!cursor) return;
                var data = cursor.value;
                var dataElement = document.createElement("div");
                dataElement.innerText = "Character: " + data.character + ", Symbol: " + data.symbol;
                dataDisplay.appendChild(dataElement);
                return cursor.continue().then(arguments.callee);
            });
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = lastKnownPart.charCodeAt(i);
                    var g = 0;
                    var b = 0;
                    var a = 255;
                    imgData.data[x + y * canvas.width * 4 + 0] = r;
                    imgData.data[x + y * canvas.width * 4 + 1] = g;
                    imgData.data[x + y * canvas.width * 4 + 2] = b;
                    imgData.data[x + y * canvas.width * 4 + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
            };
            reader.readAsText(file);
        }
            // process uploaded text document
            var fileInput = document.getElementById("document-input");
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var text = event.target.result;
                var regex = new RegExp(character, "gi");
                var matches = text.match(regex) || [];
                var hierarchy = buildHierarchy(matches, symbol);
                console.log(hierarchy);
                // display last known part of data set as pixels in canvas
                var canvas = document.getElementById("canvas-display");
                var ctx = canvas.getContext("2d");
                var
                    imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var lastKnownPart = matches[matches.length-1];
                for (var i = 0; i < lastKnownPart.length; i++) {
                    var x = i * 4;
                    var y = 0;
                    var r = 255 - imgData.data[x];
                    var g = 255 - imgData.data[x + 1];
                    var b = 255 - imgData.data[x + 2];
                    var a = 255;
                    if (lastKnownPart[i].toUpperCase() === character.toUpperCase()) {
                        r = 255;
                    }
                    imgData.data[x] = r;
                    imgData.data[x + 1] = g;
                    imgData.data[x + 2] = b;
                    imgData.data[x + 3] = a;
                }
                ctx.putImageData(imgData, 0, 0);
                // invert data selection and sort using bubble sort
                var invertedMatches = matches.slice().reverse();
                for (var i = 0; i < invertedMatches.length; i++) {
                    var invertedSymbol = symbol.repeat(i + 1);
                    hierarchy = insertNode(hierarchy, invertedMatches[i], invertedSymbol);
                }
                bubbleSort(hierarchy);
                console.log(hierarchy);
                // display raw data in raw-data-display element
                var rawDataDisplay = document.getElementById("raw-data-display");
                rawDataDisplay.innerText = JSON.stringify(hierarchy, null, 2);
                // enable download button
                var downloadButton = document.getElementById("download-button");
                downloadButton.removeAttribute("disabled");
            }
            reader.readAsText(file);
        }

        function buildHierarchy(matches, symbol) {
            var root = { name: "root", children: [] };
            matches.forEach(match => {
                var currentNode = root;
                for (var i = 0; i < match.length; i++) {
                    var character = match[i];
                    var childNode = currentNode.children.find(child => child.name === character);
                    if (!childNode) {
                        childNode = { name: character, count: 0, children: [] };
                        currentNode.children.push(childNode);
                    }
                    childNode.count++;
                    currentNode = childNode;
                }
                var leafNode = { name: symbol, count: 1 };
                currentNode.children.push(leafNode);
            });
            return root;
        }

        function insertNode(node, characters, symbol) {
            if (!node) {
                node = { name: "root", children: [] };
            }
            var currentNode = node;
            for (var i = 0; i < characters.length; i++) {
                var character = characters[i];
                var childNode = currentNode.children.find(child => child.name === character);
                if (!childNode) {
                    childNode = { name: character, count: 0, children: [] };
                    currentNode.children.push(childNode);
                }
                childNode.count++;
                currentNode = childNode;
            }
            var leafNode = { name: symbol, count: 1 };
            currentNode.children.push(leafNode);
            return node;
        }

        function bubbleSort(node) {
            if (!node.children) {
                return;
            }
            var children = node.children;
            var n = children.length;
            for (var i = 0; i < n - 1; i++) {
                for (var j = 0; j < n - i - 1; j++) {
                    if (children[j].count < children[j+1].count) {
                        var temp = children[j];
                        children[j] = children[j+1];
                        children[j+1] = temp;
                    }
                }
            }
                children.forEach(child => {
                    bubbleSort(child);
                });
            }

            function downloadData() {
                // download stored data as JSON file
                dbPromise.then(function(db) {
                    var tx = db.transaction("characters", "readonly");
                    var store = tx.objectStore("characters");
                    return store.getAll();
                }).then(function(data) {
                    var json = JSON.stringify(data, null, 2);
                    var blob = new Blob([json], { type: "application/json" });
                    var url = URL.createObjectURL(blob);
                    var link = document.createElement("a");
                    link.href = url;
                    link.download = "character-data.json";
                    link.click();
                    URL.revokeObjectURL(url);
                });
            }
    </script>
    <style>
        body {
            font-family: sans-serif;
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-top: 1em;
        }

        input {
            display: block;
        }

        button {
            margin-top: 1em;
        }

        #canvas-display {
            border: 1px solid #000;
        }

        #raw-data-display {
            border: 1px solid #000;
            white-space: pre;
        }
    </style>
</head>
<body>
<h1>Display Characters</h1>
<form>
    <label for="document-input">Upload a text document:</label>
    <input type="file" id="document-input" name="document-input">
    <br>
    <button type="button" onclick="displayCharacters()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
    <input type="text" id="character" name="character">
    <br>
    <label for="symbol">Select a custom symbol:</label>
    <select id="symbol" name="symbol">
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
    <label for="character">Enter a character:</label>
        <option value="❤️">❤️</option>
        <option value="✨">✨</option>
        <option value="⚡">⚡</option>
        <option value="🌈">🌈</option>
    </select>
    <br>
    <label for="document-input">Upload a text document:</label>
    <input type="file" id="document-input" name="document-input">
    <br>
    <button type="button" onclick="displayCharacter()">Display</button>
    <button type="button" id="download-button" disabled onclick="downloadData()">Download Data</button>
</form>
<div id="character-display"></div>
<div id="custom-symbol"></div>
<canvas id="canvas" width="400" height="100"></canvas>
<div id="data-display"></div>
<pre id="raw-data-display"></pre>
</body>
</html>
```

The `displayCharacter` function is updated to allow the user to select a custom symbol to display the processed data. Additionally, the `displayCharacter` function is updated to allow for the user to upload a text document for processing. The `buildHierarchy` function is updated to allow for an optional `symbol` parameter, which allows for the user to display a custom symbol in the tree structure.

In this updated version of the code, a raw data viewer is added below the canvas element, which displays the raw data processed by the script in a JSON format. Additionally, a download button is added, which allows the user to download all the stored data in a JSON file.

The `insertNode` function is updated to allow for an optional `node` parameter, which allows for inserting a node at a specific position in the tree.

Overall, this script allows the user to enter a character and a custom symbol, upload a text document for processing, and displays the processed data as a hierarchical tree structure. The processed data can be displayed visually in a canvas element, and the raw data can be viewed and downloaded.
                <!DOCTYPE html>
                <html>
                <head>
                    <title>My Web Page</title>
                    <style>
                        canvas {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                        }
                    </style>
                </head>
                <body>
                <canvas id="myCanvas"></canvas>
                <script>
                    const canvas = document.getElementById('myCanvas');
                    const context = canvas.getContext('2d');

                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;

                    const numCircles = 50;
                    const colors = ['#FF7F50', '#FFD700', '#32CD32', '#6495ED', '#9370DB', '#FF69B4'];

                    let circles = [];

                    // Create initial set of circles
                    createCircles();

                    // Animate the circles
                    requestAnimationFrame(animate);

                    function createCircles() {
                        circles = [];
                        for (let i = 0; i < numCircles; i++) {
                            const x = Math.random() * canvas.width;
                            const y = Math.random() * canvas.height;
                            const color = colors[Math.floor(Math.random() * colors.length)];
                            const radius = Math.random() * 40 + 10;
                            const circle = {x, y, radius, color};
                            circles.push(circle);
                        }
                    }

                    function animate() {
                        context.clearRect(0, 0, canvas.width, canvas.height);

                        // Draw the circles
                        circles.forEach(circle => {
                            context.beginPath();
                            context.arc(circle.x, circle.y, circle.radius, 0, Math.PI * 2);
                            context.fillStyle = circle.color;
                            context.fill();
                        });

                        // Sort the circles by size using bubble sort
                        bubbleSort(circles);

                        // Move the circles
                        moveCircles();

                        // Request the next animation frame
                        requestAnimationFrame(animate);
                    }

                    function moveCircles() {
                        for (let i = 0; i < numCircles; i++) {
                            const circle = circles[i];

                            // Calculate the distance between this circle and all other circles
                            const distances = circles.map(otherCircle => {
                                if (otherCircle === circle) {
                                    return Infinity;
                                } else {
                                    const dx = otherCircle.x - circle.x;
                                    const dy = otherCircle.y - circle.y;
                                    return Math.sqrt(dx * dx + dy * dy) - circle.radius - otherCircle.radius;
                                }
                            });

                            // Calculate the force on this circle
                            const forceX = distances.reduce((total, distance, index) => {
                                const otherCircle = circles[index];
                                const dx = otherCircle.x - circle.x;
                                const force = distance < 0 ? -1 : 1;
                                return total + force * dx;
                            }, 0);
                            const forceY = distances.reduce((total, distance, index) => {
                                const otherCircle = circles[index];
                                const dy = otherCircle.y - circle.y;
                                const force = distance < 0 ? -1 : 1;
                                return total + force * dy;
                            }, 0);

                            // Move the circle based on the force
                            const speed = 5;
                            circle.x += forceX * speed / circle.radius;
                            circle.y += forceY * speed / circle.radius;

                            // Keep the circle inside the canvas
                            if (circle.x < circle.radius) {
                                circle.x = circle.radius;
                            }

                            if (circle.x > canvas.width - circle.radius) {
                                circle.x = canvas.width - circle.radius;
                            }
                            if (circle.y < circle.radius) {
                                circle.y = circle.radius;
                            }
                            if (circle.y > canvas.height - circle.radius) {
                                circle.y = canvas.height - circle.radius;
                            }
                        }
                    }

                    function bubbleSort(array) {
                        const length = array.length;
                        for (let i = 0; i < length; i++) {
                            for (let j = 0; j < length - i - 1; j++) {
                                if (array[j].radius > array[j+1].radius) {
                                    const temp = array[j];
                                    array[j] = array[j+1];
                                    array[j+1] = temp;
                                }
                            }
                        }
                    }

                    // Recreate the circles when the window is resized
                    window.addEventListener('resize', () => {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                        createCircles();
                    });
                </script>
                </body>
                </html>
                ```
